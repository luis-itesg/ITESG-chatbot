<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Portal Estudiantil ITESG — Justificantes · Titulación · Residencias</title>
  <style>
    :root { --bg:#0b1220; --card:#111a2a; --muted:#9fb1d0; --text:#eaf2ff; --accent:#59a6ff; --ok:#25c08a; --warn:#f0b429; --err:#ff6b6b; }
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
    .wrap{max-width:1100px;margin:auto;padding:24px}
    h1{font-size:22px;margin:0 0 8px 0;display:flex;align-items:center;gap:14px}
    .logo{height:64px;width:auto}
    p.lead{color:var(--muted);margin:0 0 24px 0}
    .card{background:var(--card);border:1px solid #1d2a41;border-radius:16px;padding:16px;margin-bottom:16px}
    .title{font-weight:700;margin:0 0 10px 0}
    label{display:block;font-size:13px;color:var(--muted);margin:6px 0 6px}
    input,select,textarea{width:100%;padding:10px 12px;background:#0c1627;border:1px solid #1f2b45;color:var(--text);border-radius:10px;outline:none}
    textarea{resize:vertical}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
    .btn{appearance:none;border:none;background:var(--accent);color:#08111f;font-weight:700;padding:10px 14px;border-radius:12px;cursor:pointer}
    .muted{color:var(--muted);font-size:12px}
    .status{margin-top:10px;font-size:14px}
    .ok{color:var(--ok)} .warn{color:var(--warn)} .err{color:var(--err)}
    a{color:var(--accent)}
    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0 16px}
    .tab{padding:8px 12px;border-radius:999px;border:1px solid #1d2a41;background:#101a2b;color:var(--muted);cursor:pointer}
    .tab.active{background:var(--accent);color:#08111f;border-color:transparent}
    .hidden{display:none}
    /* Chat */
    #chatBox{max-height:300px;overflow-y:auto;padding:12px;background:#0c1627;border:1px solid #1f2b45;border-radius:10px;margin-bottom:10px}
    .msg{margin:6px 0;padding:8px 12px;border-radius:12px;max-width:75%}
    .user{background:#59a6ff;color:#08111f;margin-left:auto}
    .bot{background:#1d2a41;color:#eaf2ff;margin-right:auto}
    /* Barra de conexión */
    .conn{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:end}
    .conn small{display:block;color:var(--muted);margin-top:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>
      <img src="logo.png" alt="Logo ITESG" class="logo">
      Portal Estudiantil ITESG — Justificantes · Titulación · Residencias
    </h1>
    <p class="lead">Consulta pasos oficiales, descarga formatos y chatea con el asistente. <em>Powered by Ingeniería Industrial ITESG</em>.</p>

    <!-- Barra visible para configurar el webhook de n8n (prellenada) -->
    <div class="card">
      <div class="conn">
        <div>
          <label for="wF">Webhook de formatos (n8n)</label>
          <input id="wF" value="https://discover-surveillance-maximize-thesaurus.trycloudflare.com/webhook/formatos" />
          <small>Si tu túnel cambia, pega aquí la nueva URL y dale “Guardar”.</small>
        </div>
        <div>
          <button id="saveCfg" class="btn" style="width:140px">Guardar</button>
        </div>
      </div>
      <div id="cfgStatus" class="status muted" style="margin-top:8px"></div>
    </div>

    <!-- NAV TABS (sin pestaña Config) -->
    <div class="tabs">
      <button class="tab active" data-tab="tab-chat">Chat (IA)</button>
      <button class="tab" data-tab="tab-justificantes">Justificantes</button>
      <button class="tab" data-tab="tab-residencias">Residencias</button>
      <button class="tab" data-tab="tab-titulacion">Solicitud de Titulación</button>
      <button class="tab" data-tab="tab-seguimiento">Seguimiento</button>
      <button class="tab" data-tab="tab-anexo1">Registro Proyecto (Anexo I)</button>
      <button class="tab" data-tab="tab-asesorias">Asesorías de Titulación</button>
    </div>

    <!-- CHAT -->
    <section id="tab-chat" class="tabpage">
      <div class="card">
        <h2 class="title">Chat con el asistente (IA)</h2>
        <div id="chatBox"></div>
        <form id="chatForm" style="display:flex;gap:8px">
          <input id="chatInput" placeholder="Escribe tu pregunta..." style="flex:1" />
          <button class="btn" type="submit">Enviar</button>
        </form>
      </div>
    </section>
    <!-- JUSTIFICANTES -->
    <section id="tab-justificantes" class="tabpage hidden">
      <div class="card">
        <h2 class="title">Generar justificante</h2>
        <form id="formJustificante">
          <input type="hidden" id="tipoJ" value="justificante" />

          <label for="nombreJ">Nombre completo</label>
          <input id="nombreJ" required />

          <label for="numControlJ">Número de control</label>
          <input id="numControlJ" required />

          <label for="motivoJ">Motivo</label>
          <textarea id="motivoJ" rows="3"></textarea>

          <label for="fechaJ">Fecha</label>
          <input id="fechaJ" type="date" />

          <label for="asignaturasJ">Asignaturas y docentes involucrados</label>
          <textarea id="asignaturasJ" rows="3"></textarea>

          <!-- DÍAS DE INASISTENCIA -->
          <h3 class="title" style="margin-top:14px">Días de inasistencia (hasta 3 filas)</h3>

          <!-- Fila 1 -->
          <div class="row">
            <div>
              <label for="d1del">Días del</label>
              <input id="d1del" placeholder="10" />
            </div>
            <div>
              <label for="d1al">al</label>
              <input id="d1al" placeholder="12" />
            </div>
          </div>
          <div class="row3">
            <div>
              <label for="mes1">Mes</label>
              <input id="mes1" placeholder="Septiembre" />
            </div>
            <div>
              <label for="h1de">Horario de</label>
              <input id="h1de" placeholder="08:00" />
            </div>
            <div>
              <label for="h1a">a</label>
              <input id="h1a" placeholder="10:00" />
            </div>
          </div>

          <!-- Fila 2 -->
          <div class="row" style="margin-top:6px">
            <div>
              <label for="d2del">Días del</label>
              <input id="d2del" />
            </div>
            <div>
              <label for="d2al">al</label>
              <input id="d2al" />
            </div>
          </div>
          <div class="row3">
            <div>
              <label for="mes2">Mes</label>
              <input id="mes2" />
            </div>
            <div>
              <label for="h2de">Horario de</label>
              <input id="h2de" />
            </div>
            <div>
              <label for="h2a">a</label>
              <input id="h2a" />
            </div>
          </div>

          <!-- Fila 3 -->
          <div class="row" style="margin-top:6px">
            <div>
              <label for="d3del">Días del</label>
              <input id="d3del" />
            </div>
            <div>
              <label for="d3al">al</label>
              <input id="d3al" />
            </div>
          </div>
          <div class="row3">
            <div>
              <label for="mes3">Mes</label>
              <input id="mes3" />
            </div>
            <div>
              <label for="h3de">Horario de</label>
              <input id="h3de" />
            </div>
            <div>
              <label for="h3a">a</label>
              <input id="h3a" />
            </div>
          </div>

          <p class="muted" style="margin-top:8px">Nota: Adjunta evidencia que respalde la solicitud (ejemplo: justificante médico).</p>
          <div style="margin-top:12px"><button class="btn" type="submit">Generar PDF</button></div>
        </form>
        <div id="outJustificante" class="status"></div>
      </div>
    </section>

    <!-- RESIDENCIAS -->
    <section id="tab-residencias" class="tabpage hidden">
      <div class="card">
        <h2 class="title">Generar solicitud de residencias</h2>
        <form id="formResidencias">
          <input type="hidden" id="tipoR" value="residencias_solicitud" />

          <label for="nombreR">Nombre completo</label>
          <input id="nombreR" required />

          <label for="numControlR">Número de control</label>
          <input id="numControlR" required />

          <label for="empresaR">Empresa</label>
          <input id="empresaR" />

          <label for="proyectoR">Proyecto</label>
          <input id="proyectoR" />

          <p class="muted">Además de esta solicitud, adjuntar Carta de presentación, Anteproyecto, Carta de agradecimiento y Kardex.</p>
          <div style="margin-top:12px"><button class="btn" type="submit">Generar solicitud</button></div>
        </form>
        <div id="outResidencias" class="status"></div>
      </div>
    </section>

    <!-- SOLICITUD DE TITULACIÓN -->
    <section id="tab-titulacion" class="tabpage hidden">
      <div class="card">
        <h2 class="title">Generar solicitud de titulación</h2>
        <form id="formTitulacion">
          <input type="hidden" id="tipoT" value="titulacion_solicitud" />

          <label for="planT">Plan de estudios</label>
          <select id="planT">
            <option value="plan2004">Plan 2004</option>
            <option value="plan2010">Plan 2010</option>
          </select>

          <label for="opcionT">Opción de titulación</label>
          <select id="opcionT"></select>
          <div id="opcionHintT" class="muted" style="margin-top:6px"></div>

          <div class="row">
            <div>
              <label for="apPatT">Apellido paterno</label>
              <input id="apPatT" required />
            </div>
            <div>
              <label for="apMatT">Apellido materno</label>
              <input id="apMatT" />
            </div>
          </div>

          <label for="nombresT">Nombres</label>
          <input id="nombresT" required />

          <div class="row">
            <div>
              <label for="carreraT">Carrera</label>
              <input id="carreraT" placeholder="Ing. Industrial" />
            </div>
            <div>
              <label for="tramiteT">Trámite</label>
              <select id="tramiteT">
                <option value="primera_vez">Primera vez</option>
                <option value="reinicio">Reinicio</option>
              </select>
            </div>
          </div>

          <label for="numControlT">Número de control</label>
          <input id="numControlT" />

          <h3 class="title" style="margin-top:12px">Datos de contacto</h3>
          <label for="domT">Domicilio</label>
          <input id="domT" />
          <div class="row">
            <div>
              <label for="correoTT">Correo electrónico</label>
              <input id="correoTT" type="email" />
            </div>
            <div>
              <label for="telCasaT">Teléfono de casa</label>
              <input id="telCasaT" />
            </div>
          </div>
          <label for="telCelT">Teléfono celular</label>
          <input id="telCelT" />

          <div id="proyectoBoxT" class="hidden" style="margin-top:12px">
            <label for="proyectoT">Nombre del proyecto (si aplica)</label>
            <input id="proyectoT" placeholder="No aplica para EGEL" />
          </div>

          <p class="muted">El PDF se llenará solo hasta “SOLICITÓ CANDIDATO(A)”. Las validaciones posteriores se hacen en las áreas institucionales.</p>
          <div style="margin-top:12px"><button class="btn" type="submit">Generar solicitud</button></div>
        </form>
        <div id="outTitulacion" class="status"></div>
      </div>
    </section>

    <!-- SEGUIMIENTO TITULACIÓN -->
    <section id="tab-seguimiento" class="tabpage hidden">
      <div class="card">
        <h2 class="title">Seguimiento de titulación</h2>
        <form id="formEstadoTit">
          <div class="row">
            <div>
              <label for="estadoNumCtrl">Número de control</label>
              <input id="estadoNumCtrl" required />
            </div>
            <div>
              <label for="estadoTipo">Verificar con</label>
              <select id="estadoTipo">
                <option value="apellido">Apellido paterno</option>
                <option value="nss3">NSS (últimos 3)</option>
              </select>
            </div>
          </div>
          <label for="estadoValor">Valor del verificador</label>
          <input id="estadoValor" placeholder="ej. lopez / 527" />
          <div style="margin-top:12px"><button class="btn" type="submit">Consultar</button></div>
        </form>
        <div id="outEstadoTit" class="status"></div>
      </div>
    </section>

    <!-- REGISTRO DE PROYECTO (ANEXO I) -->
    <section id="tab-anexo1" class="tabpage hidden">
      <div class="card">
        <h2 class="title">Registro de Proyecto — Anexo I</h2>
        <form id="formAnexo1">
          <input type="hidden" id="tipoA1" value="titulacion_registro_proyecto" />

          <h3 class="title">Datos generales</h3>
          <label for="a1Proyecto">Nombre del Proyecto</label>
          <input id="a1Proyecto" />
          <label for="a1Asesor">Nombre del Asesor(a)</label>
          <input id="a1Asesor" />
          <label for="a1NumEst">No. de Estudiantes</label>
          <input id="a1NumEst" type="number" min="1" />

          <h3 class="title">Participantes (egresados)</h3>
          <p class="muted">Un estudiante por línea: <em>Nombre completo | No. de control | Carrera</em></p>
          <textarea id="a1Participantes" rows="5" placeholder="Nombre Apellido | A00-0000 | Ing. Industrial&#10;..."></textarea>

          <label for="a1Obs">Observaciones</label>
          <textarea id="a1Obs" rows="3"></textarea>

          <p class="muted">Las firmas de conformidad y Vo. Bo. se realizan en físico en la hoja oficial.</p>
          <div style="margin-top:12px"><button class="btn" type="submit">Generar Anexo I (PDF)</button></div>
        </form>
        <div id="outAnexo1" class="status"></div>
      </div>
    </section>

    <!-- REPORTE DE ASESORÍAS -->
    <section id="tab-asesorias" class="tabpage hidden">
      <div class="card">
        <h2 class="title">Reporte de Seguimiento de Asesorías</h2>
        <form id="formAsesorias">
          <input type="hidden" id="tipoAs" value="titulacion_asesorias_reporte" />

          <div class="row">
            <div>
              <label for="asProyecto">Proyecto</label>
              <input id="asProyecto" />
            </div>
            <div>
              <label for="asAsesor">Asesor interno</label>
              <input id="asAsesor" />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="asAlumno">Alumno(a)</label>
              <input id="asAlumno" />
            </div>
            <div>
              <label for="asControl">Número de control</label>
              <input id="asControl" />
            </div>
          </div>

          <h3 class="title">Sesión</h3>
          <div class="row">
            <div>
              <label for="asNum">No. de sesión</label>
              <input id="asNum" type="number" min="1" />
            </div>
            <div>
              <label for="asFecha">Fecha</label>
              <input id="asFecha" type="date" />
            </div>
          </div>
          <label for="asAcuerdos">Acuerdos / Avances</label>
          <textarea id="asAcuerdos" rows="4"></textarea>
          <label for="asObserv">Observaciones</label>
          <textarea id="asObserv" rows="3"></textarea>

          <p class="muted">El documento oficial contempla firmas del asesor y del estudiante por sesión.</p>
          <div style="margin-top:12px"><button class="btn" type="submit">Generar reporte (PDF)</button></div>
        </form>
        <div id="outAsesorias" class="status"></div>
      </div>
    </section>

    <p class="muted">Privacidad: esta página no publica horarios de docentes ni listados de grupos. Solo procesos y formatos.</p>
  <!-- ========== SCRIPT ========== -->
  <script>
    /* ====== CONFIG BÁSICA (webhook visible) ====== */
    // Input visible en la cabecera (id="webhookInput") con valor por defecto:
    const DEFAULT_WEBHOOK = 'https://discover-surveillance-maximize-thesaurus.trycloudflare.com/webhook/formatos';
    const WK_STORAGE_KEY = 'webhook_formatos';
    const $wk = document.getElementById('webhookInput');
    function loadWebhook(){
      const saved = localStorage.getItem(WK_STORAGE_KEY);
      $wk.value = saved || DEFAULT_WEBHOOK;
    }
    function saveWebhook(){
      const v = ($wk.value || '').trim();
      if(v) localStorage.setItem(WK_STORAGE_KEY, v);
    }
    loadWebhook();
    $wk.addEventListener('change', saveWebhook);

    function getWebhook(){
      return ($wk.value || DEFAULT_WEBHOOK).trim();
    }

    /* ====== TABS ====== */
    const tabs = document.querySelectorAll('.tab');
    const pages = document.querySelectorAll('.tabpage');
    tabs.forEach(t => t.addEventListener('click', () => {
      tabs.forEach(x => x.classList.remove('active'));
      pages.forEach(p => p.classList.add('hidden'));
      t.classList.add('active');
      document.getElementById(t.dataset.tab).classList.remove('hidden');
    }));

    /* ====== HELPERS ====== */
    const j = id => document.getElementById(id);
    async function postJSON(url, body){
      const res = await fetch(url, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify(body)
      });
      if(!res.ok) throw new Error('HTTP '+res.status);
      return res.json();
    }

    /* ====== JUSTIFICANTES ====== */
    j('formJustificante').addEventListener('submit', async e=>{
      e.preventDefault();
      const out = j('outJustificante');
      const url = getWebhook();
      const payload = {
        tipo: j('tipoJ').value,
        nombre: j('nombreJ').value,
        numero_control: j('numControlJ').value,
        motivo: j('motivoJ').value,
        fecha: j('fechaJ').value,
        asignaturas: j('asignaturasJ').value,
        // días/mes/horarios
        d1del:j('d1del').value, d1al:j('d1al').value, mes1:j('mes1').value,
        h1de:j('h1de').value,   h1a:j('h1a').value,
        d2del:j('d2del').value, d2al:j('d2al').value, mes2:j('mes2').value,
        h2de:j('h2de').value,   h2a:j('h2a').value,
        d3del:j('d3del').value, d3al:j('d3al').value, mes3:j('mes3').value,
        h3de:j('h3de').value,   h3a:j('h3a').value
      };
      out.textContent='Generando…';
      try{
        const d = await postJSON(url, payload);
        out.innerHTML = d?.ok ? `✅ <a href="${d.fileUrl}" target="_blank">Descargar</a>` : 'Error en servidor';
      }catch(err){ out.textContent = err.message || err; }
    });

    /* ====== RESIDENCIAS ====== */
    j('formResidencias').addEventListener('submit', async e=>{
      e.preventDefault();
      const out = j('outResidencias');
      const url = getWebhook();
      const payload = {
        tipo: j('tipoR').value,
        nombre: j('nombreR').value,
        numero_control: j('numControlR').value,
        empresa: j('empresaR').value,
        proyecto: j('proyectoR').value
      };
      out.textContent='Generando…';
      try{
        const d = await postJSON(url, payload);
        out.innerHTML = d?.ok ? `✅ <a href="${d.fileUrl}" target="_blank">Descargar</a>` : 'Error';
      }catch(err){ out.textContent = err.message || err; }
    });

    /* ====== TITULACIÓN (opciones por plan) ====== */
    const OPCIONES_2004 = [
      {v:'tesis', t:'Tesis'},
      {v:'material_didactico', t:'Elaboración de texto o materiales didácticos'},
      {v:'proyecto_investigacion', t:'Proyecto de investigación'},
      {v:'curso_especial', t:'Curso especial de titulación'},
      {v:'examen_areas_na', t:'Examen por áreas de conocimiento (N/A)'},
      {v:'memoria_experiencia', t:'Memoria de experiencia profesional'},
      {v:'escolaridad_na', t:'Escolaridad (Aprovechamiento Académico) (N/A)'},
      {v:'creditos_posgrado_na', t:'Créditos de posgrado (N/A)'},
      {v:'memoria_residencia', t:'Memoria de residencia profesional'},
      {v:'titulacion_integrada', t:'Titulación Integrada'}
    ];
    const OPCIONES_2010 = [
      {v:'tesis_tesina', t:'Tesis o Tesina'},
      {v:'innovacion_tecnologica', t:'Proyecto de Innovación Tecnológica'},
      {v:'inv_o_desarrollo_tec', t:'Proyecto de Investigación o Desarrollo Tecnológico'},
      {v:'emprendedurismo', t:'Proyecto de Emprendedurismo'},
      {v:'examen_areas_egel_na', t:'Examen por áreas (Testimonio Satisfactorio/Sobresaliente EGEL, N/A)'},
      {v:'estancia', t:'Estancia'},
      {v:'proyecto_integrador', t:'Proyecto Integrador'},
      {v:'proyecto_productivo', t:'Proyecto Productivo'},
      {v:'memoria_residencia', t:'Memoria de residencia profesional'},
      {v:'dual', t:'Proyecto Integral de Educación Dual'}
    ];
    const HINTS_OPCION = {
      examen_areas_na:'Marcado como N/A; verificar políticas vigentes.',
      escolaridad_na:'Marcado como N/A; sujeto a lineamientos del campus.',
      creditos_posgrado_na:'Marcado como N/A; revisar disposiciones actuales.',
      examen_areas_egel_na:'Marcado como N/A en el formato (EGEL).',
      memoria_residencia:'Se basa en el informe de residencias y su liberación.'
    };

    const selPlan = j('planT');
    const selOpcion = j('opcionT');
    const hintOpcion = j('opcionHintT');
    function renderOpciones(){
      const list = selPlan.value === 'plan2010' ? OPCIONES_2010 : OPCIONES_2004;
      selOpcion.innerHTML = '';
      list.forEach(opt=>{
        const o = document.createElement('option');
        o.value = opt.v; o.textContent = opt.t;
        selOpcion.appendChild(o);
      });
      updateOpcionHint();
      toggleProyecto();
    }
    function updateOpcionHint(){
      const v = selOpcion.value;
      hintOpcion.textContent = HINTS_OPCION[v] || '';
    }
    function toggleProyecto(){
      const v = selOpcion.value;
      const esEGEL = (v === 'examen_areas_na' || v === 'examen_areas_egel_na');
      const box = document.getElementById('proyectoBoxT');
      if(box) box.classList.toggle('hidden', esEGEL);
    }
    selPlan?.addEventListener('change', renderOpciones);
    selOpcion?.addEventListener('change', ()=>{ updateOpcionHint(); toggleProyecto(); });
    renderOpciones();

    /* ====== TITULACIÓN (envío) ====== */
    j('formTitulacion').addEventListener('submit', async e=>{
      e.preventDefault();
      const out = j('outTitulacion');
      const url = getWebhook();
      const payload = {
        tipo: j('tipoT').value,
        plan: j('planT').value,
        opcion: j('opcionT').value,
        ap_paterno: j('apPatT')?.value || '',
        ap_materno: j('apMatT')?.value || '',
        nombres: j('nombresT')?.value || '',
        carrera: j('carreraT')?.value || '',
        tramite: j('tramiteT')?.value || '',
        numero_control: j('numControlT')?.value || '',
        domicilio: j('domT')?.value || '',
        correo: j('correoTT')?.value || '',
        tel_casa: j('telCasaT')?.value || '',
        tel_cel: j('telCelT')?.value || '',
        nombre_proyecto: (document.getElementById('proyectoBoxT')?.classList.contains('hidden') ? '' : (j('proyectoT')?.value || ''))
      };
      out.textContent='Generando…';
      try{
        const d = await postJSON(url, payload);
        out.innerHTML = d?.ok ? `✅ <a href="${d.fileUrl}" target="_blank">Descargar</a>` : 'Error';
      }catch(err){ out.textContent = err.message || err; }
    });

    /* ====== SEGUIMIENTO (usa mismo webhook) ====== */
    j('formEstadoTit').addEventListener('submit', async e=>{
      e.preventDefault();
      const out = j('outEstadoTit');
      const url = getWebhook();
      const payload = {
        tipo: 'titulacion_estado',
        numero_control: j('estadoNumCtrl').value.trim(),
        verificador_tipo: j('estadoTipo').value,
        verificador_valor: j('estadoValor').value.trim()
      };
      out.textContent='Consultando…';
      try{
        const d = await postJSON(url, payload);
        if(d?.ok){
          out.innerHTML = `Etapa: <strong>${d.etapa||'-'}</strong>${d.oficio?` — Oficio: <strong>${d.oficio}</strong>`:''}<br><span class="muted">Última actualización: ${d.ultima_actualizacion||'-'}</span>`;
        }else{
          out.innerHTML = '<span class="warn">Sin resultados o verificador incorrecto.</span>';
        }
      }catch(err){ out.innerHTML = '<span class="err">Error: '+(err.message||err)+'</span>'; }
    });

    /* ====== ANEXO I ====== */
    j('formAnexo1').addEventListener('submit', async e=>{
      e.preventDefault();
      const out = j('outAnexo1');
      const url = getWebhook();
      const payload = {
        tipo: j('tipoA1').value,
        proyecto: j('a1Proyecto').value,
        asesor: j('a1Asesor').value,
        num_estudiantes: j('a1NumEst').value,
        participantes: j('a1Participantes').value,
        observaciones: j('a1Obs').value
      };
      out.textContent='Generando…';
      try{
        const d = await postJSON(url, payload);
        out.innerHTML = d?.ok ? `✅ <a href="${d.fileUrl}" target="_blank">Descargar</a>` : 'Error';
      }catch(err){ out.textContent = err.message || err; }
    });

    /* ====== ASESORÍAS ====== */
    j('formAsesorias').addEventListener('submit', async e=>{
      e.preventDefault();
      const out = j('outAsesorias');
      const url = getWebhook();
      const payload = {
        tipo: j('tipoAs').value,
        proyecto: j('asProyecto').value,
        asesor_interno: j('asAsesor').value,
        alumno: j('asAlumno').value,
        numero_control: j('asControl').value,
        sesion_num: j('asNum').value,
        sesion_fecha: j('asFecha').value,
        acuerdos: j('asAcuerdos').value,
        observaciones: j('asObserv').value
      };
      out.textContent='Generando…';
      try{
        const d = await postJSON(url, payload);
        out.innerHTML = d?.ok ? `✅ <a href="${d.fileUrl}" target="_blank">Descargar</a>` : 'Error';
      }catch(err){ out.textContent = err.message || err; }
    });

    /* ====== CHAT (placeholder) ====== */
    // Si en el futuro quieres Q&A, añadimos un input similar para QA_WEBHOOK.
    const chatBox = document.getElementById('chatBox');
    document.getElementById('chatForm').addEventListener('submit', e=>{
      e.preventDefault();
      const txt = document.getElementById('chatInput').value.trim();
      if(!txt) return;
      const userMsg = document.createElement('div');
      userMsg.className = 'msg user';
      userMsg.textContent = txt;
      chatBox.appendChild(userMsg);
      document.getElementById('chatInput').value='';
      chatBox.scrollTop = chatBox.scrollHeight;

      const botMsg = document.createElement('div');
      botMsg.className = 'msg bot';
      botMsg.textContent = 'Q&A no configurado aún.';
      chatBox.appendChild(botMsg);
      chatBox.scrollTop = chatBox.scrollHeight;
    });
  </script>
</div>
</body>
</html>
